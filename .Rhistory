library(sf)
library(sp)
library(here)
library(tmap)
library(tmaptools)
library(ggplot2)
library(ggpubr)
library(dplyr)
library(tidyverse)
library(spatstat)
library(maptools)
here()
df<- read_csv(here("csse_covid_19_data","csse_covid_19_time_series","time_series_covid19_confirmed_global.csv"))
df<- read_csv(here("csse_covid_19_data","csse_covid_19_time_series","time_series_covid19_confirmed_global.csv"))
head(df)
china<- df%>%
filter(., `Country/Region` == "China" | `Country/Region` == "Taiwan*")
china[34,1]<- "Taiwan"
head(china)
map1<- st_read(here("gadm36_CHN_shp","gadm36_CHN_1.shp"))%>%
st_simplify(., dTolerance = 5000)
head(map1)
View(map1)
map1<- st_read(here("gadm36_CHN_shp","gadm36_CHN_1.shp"))%>%
st_simplify(., dTolerance = 5000)
map2<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))%>%
st_simplify(., dTolerance = 5000)
map3<- st_read(here("gadm36_HKG_shp","gadm36_HKG_0.shp"))%>%
st_simplify(., dTolerance = 5000)
map4<- st_read(here("gadm36_HKG_shp","gadm36_HKG_0.shp"))%>%
st_simplify(., dTolerance = 5000)
View(map2)
qtm(map1)
map2<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))
View(map2)
map2<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))%>%
st_simplify(., dTolerance = 1000)
map2<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))
map_chn<- rbind(map1,map2,map3,map4)
View(map3)
View(map4)
qtm(map2)
map1<- st_read(here("gadm36_CHN_shp","gadm36_CHN_1.shp"))
map1<- st_read(here("gadm36_CHN_shp","gadm36_CHN_1.shp"))
map_chn<- rbind(map1,map2,map3,map4)
map1<- st_read(here("gadm36_CHN_shp","gadm36_CHN_1.shp"))%>%
st_simplify(., dTolerance = 1000)
library(maptools)
data(wrld_simpl)
plot(wrld_simpl)
View(wrld_simpl)
rm(wrld_simpl)
head(map_sim)
map<- map[,-3:-1]
map<- st_read(here("sheng","CN-sheng-A.shp"))%>%
filter(!is.na(name))%>%
add_row(name = "Hong Kong")%>%
add_row(name = "Macau")
map<- map[,-3:-1]
head(map)
map_sim<- st_simplify(map, dTolerance = 5000)
tmap_mode("plot")
qtm(map_sim)
china<- china%>%
st_as_sf(., coords = c("Long", "Lat"), crs = 4326)%>%
st_transform(., crs = st_crs(map))
qtm(map_sim)+
tm_shape(china)+
tm_dots('2/7/21')
print(map_sim$name)
print(china$`Province/State`)
map_sim$name<- c("Heilongjiang","Inner Mongolia","Xinjiang","Jilin","Liaoning","Hebei","Gansu","Beijing","Shanxi","Tianjin","Shaanxi","Qinghai","Ningxia","Shandong","Tibet","Henan","Jiangsu","Anhui","Sichuan","Hubei","Shanghai","Chongqing","Zhejiang","Jiangxi","Hunan","Yunan","Guizhou","Fujian","Guangxi","Taiwan","Guangdong","Hainan","Hong Kong","Macau")
print(head(map_sim))
print(head(china))
china_death<- china%>%
st_drop_geometry(.)%>%
merge(map_sim,., by.x = "name", by.y = "Province/State")
head(china_death)
rm(map1)
rm(map2)
rm(map3)
rm(map4)
View(china_death)
map_mac<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))
map_hk<- st_read(here("gadm36_HKG_shp","gadm36_HKG_0.shp"))
View(map_mac)
map_mac<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))%>%
st_transform(., crs = st_crs(map))
map_hk<- st_read(here("gadm36_HKG_shp","gadm36_HKG_0.shp"))%>%
st_transform(., crs = st_crs(map))
View(map_sim)
crs(map_hk)
print(crs(map_hk))
print(st_crs(map_hk))
df<- read_csv(here("csse_covid_19_data","csse_covid_19_time_series","time_series_covid19_deaths_global.csv"))
head(df)
china<- df%>%
filter(., `Country/Region` == "China" | `Country/Region` == "Taiwan*")
china[34,1]<- "Taiwan"
china<- china%>%
st_as_sf(., coords = c("Long", "Lat"), crs = 4326)%>%
st_transform(., crs = st_crs(map))
qtm(map_sim)+
tm_shape(china)+
tm_dots('2/7/21')
print(map_sim$name)
print(china$`Province/State`)
map_sim$name<- c("Heilongjiang","Inner Mongolia","Xinjiang","Jilin","Liaoning","Hebei","Gansu","Beijing","Shanxi","Tianjin","Shaanxi","Qinghai","Ningxia","Shandong","Tibet","Henan","Jiangsu","Anhui","Sichuan","Hubei","Shanghai","Chongqing","Zhejiang","Jiangxi","Hunan","Yunan","Guizhou","Fujian","Guangxi","Taiwan","Guangdong","Hainan","Hong Kong","Macau")
china_death<- china%>%
st_drop_geometry(.)%>%
merge(map_sim,., by.x = "name", by.y = "Province/State")
china_death[13,388]
china_death[21,388]
china_death[13,388]<- map_hk$geometry
china_death[13,388]<- map_hk[1,3]
china_death[21,388]<- map_mac[1,3]
tm_shape(china_death)+
tm_fill('2/7/21')
tm_shape(china_death)+
tm_fill('2/7/21')+
tm_borders()
tm_shape(china_death)+
tm_polygons('2/7/21', border.alpha = 0.5)
tm_shape(china_death)+
tm_polygons('2/7/21')
map<- st_read(here("sheng","CN-sheng-A.shp"))%>%
filter(!is.na(name))
#add_row(name = "Hong Kong")%>%
#add_row(name = "Macau")
map<- map[,-3:-1]
head(map)
map_sim<- st_simplify(map, dTolerance = 5000)
tmap_mode("plot")
print(map_sim$name)
map_sim$name<- c("Heilongjiang","Inner Mongolia","Xinjiang","Jilin","Liaoning","Hebei","Gansu","Beijing","Shanxi","Tianjin","Shaanxi","Qinghai","Ningxia","Shandong","Tibet","Henan","Jiangsu","Anhui","Sichuan","Hubei","Shanghai","Chongqing","Zhejiang","Jiangxi","Hunan","Yunan","Guizhou","Fujian","Guangxi","Taiwan","Guangdong","Hainan","Hong Kong","Macau")
map<- st_read(here("sheng","CN-sheng-A.shp"))%>%
filter(!is.na(name))%>%
add_row(name = "Hong Kong")%>%
add_row(name = "Macau")
#没有港澳。。
map<- map[,-3:-1]
map_sim<- st_simplify(map, dTolerance = 5000)
qtm(map_sim)
china<- china%>%
st_as_sf(., coords = c("Long", "Lat"), crs = 4326)%>%
st_transform(., crs = st_crs(map))
qtm(map_sim)+
tm_shape(china)+
tm_dots('2/7/21')
china<- china%>%
st_as_sf(., coords = c("Long", "Lat"), crs = 4326)%>%
st_transform(., crs = st_crs(map))
qtm(map_sim)+
tm_shape(china)+
tm_dots('2/7/21')
hist(china_death, '2/7/21')
hist(china_death$`2/7/21`)
hist(china_death$`2/7/21`, breaks = 5)
hist(china_death$`2/7/21`, breaks = 10000)
hist(china_death$`2/7/21`, breaks = 5000)
map_sim$name<- c("Heilongjiang","Inner Mongolia","Xinjiang","Jilin","Liaoning","Hebei","Gansu","Beijing","Shanxi","Tianjin","Shaanxi","Qinghai","Ningxia","Shandong","Tibet","Henan","Jiangsu","Anhui","Sichuan","Hubei","Shanghai","Chongqing","Zhejiang","Jiangxi","Hunan","Yunan","Guizhou","Fujian","Guangxi","Taiwan","Guangdong","Hainan","Hong Kong","Macau")
map_mac<- st_read(here("gadm36_MAC_shp","gadm36_MAC_0.shp"))%>%
st_transform(., crs = st_crs(map))
map_hk<- st_read(here("gadm36_HKG_shp","gadm36_HKG_0.shp"))%>%
st_transform(., crs = st_crs(map))
#给hopkins的数据改成map的geometry
china_death<- china%>%
st_drop_geometry(.)%>%
merge(map_sim,., by.x = "name", by.y = "Province/State")
china_death[21,388]<- map_mac[1,3]
#加上hk 和mac 的 geometry
china_death[13,388]<- map_hk[1,3]
tm_shape(china_death)+
tm_polygons('2/7/21')
hist(china_death$`2/7/21`, breaks = 5000)
